<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Sıralı Falling CAPTCHA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      background: #0f172a;
      font-family: "Inter", sans-serif;
      color: #e2e8f0;
      display: flex;
      justify-content: center;
      padding: 40px;
    }

    .box {
      width: 360px;
      background: #1e293b;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #334155;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      background: #0f172a;
      border: 1px solid #475569;
      border-radius: 6px;
      color: #e2e8f0;
    }

    #captchaCanvas {
      width: 100%;
      border: 2px solid #334155;
      border-radius: 10px;
      margin-top: 12px;
    }

    #progress {
      text-align: center;
      margin-top: 10px;
      color: #94a3b8;
    }

    #success {
      display: none;
      text-align: center;
      margin-top: 16px;
      font-size: 20px;
      color: #22c55e;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <div class="box">
    <h2 style="text-align:center; margin:0;">Güvenlik Doğrulama</h2>

    <input placeholder="Kullanıcı adı">
    <input placeholder="Şifre" type="password">

    <canvas id="captchaCanvas" width="320" height="220"></canvas>
    <div id="progress"></div>

    <div id="success">✔ Tebrikler! Doğrulama tamamlandı.</div>
  </div>


  <script>
    const canvas = document.getElementById("captchaCanvas");
    const ctx = canvas.getContext("2d");
    const progress = document.getElementById("progress");
    const success = document.getElementById("success");

    const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
    const code = Array.from({ length: 5 })
      .map(() => letters[Math.floor(Math.random() * letters.length)]);

    let currentIndex = 0;
    progress.innerHTML = `Sıradaki harf: <b>${code[currentIndex]}</b><br/>Kod: ${code.join(" ")}`;

    let falling = [];

    function spawnLetter(isTarget) {
      const letter = isTarget ? code[currentIndex] : letters[Math.floor(Math.random() * letters.length)];
      return {
        letter,
        x: Math.random() * 260 + 20,
        y: -20,
        speed: isTarget ? 2 + Math.random()*1.3 : 1.4 + Math.random()*1.7,
        drift: (Math.random() - 0.5) * 1.5,
        isTarget
      };
    }

    // başta birkaç tane oluştur
    for (let i = 0; i < 7; i++) {
      falling.push(spawnLetter(i === 0));
    }

    function draw() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      falling.forEach((f, i) => {
        ctx.fillStyle = f.isTarget ? "#38bdf8" : "#64748b";
        ctx.font = "26px Arial";
        ctx.fillText(f.letter, f.x, f.y);

        f.y += f.speed;
        f.x += f.drift;

        if (f.x < 10 || f.x > 290) f.drift *= -1;

        if (f.y > 260) {
          // hedef değilse reset
          falling[i] = spawnLetter(f.isTarget);
        }
      });

      requestAnimationFrame(draw);
    }

    draw();

    canvas.addEventListener("click", (e) => {
      if (currentIndex >= 5) return;

      const rect = canvas.getBoundingClientRect();
      const px = e.clientX - rect.left;
      const py = e.clientY - rect.top;

      for (let i = 0; i < falling.length; i++) {
        const f = falling[i];

        const hit = px > f.x - 10 && px < f.x + 20 && py > f.y - 25 && py < f.y + 10;

        if (hit) {
          if (f.isTarget) {
            // ✔ doğru tıklama
            burst(px, py);

            currentIndex++;
            if (currentIndex === 5) {
              success.style.display = "block";
              progress.innerHTML = "Tamamlandı ✔";
              return;
            }

            progress.innerHTML = `Sıradaki harf: <b>${code[currentIndex]}</b><br/>Kod: ${code.join(" ")}`;

            // hedef değişti, düşen listeyi temizle
            falling = [];
            for (let j = 0; j < 7; j++) {
              falling.push(spawnLetter(j === 0));
            }

          } else {
            // ❌ yanlış tıklama
            progress.innerHTML = `<span style="color:#ef4444">Yanlış! Sıradaki harf: <b>${code[currentIndex]}</b></span>`;
          }
        }
      }
    });

    function burst(x, y) {
      for (let i = 0; i < 20; i++) {
        ctx.fillStyle = "#22c55e";
        ctx.fillRect(
          x + (Math.random() - 0.5) * 20,
          y + (Math.random() - 0.5) * 20,
          4,
          4
        );
      }
    }
  </script>

</body>
</html>
