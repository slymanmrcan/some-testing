<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>CAPTCHA Doğrulaması</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #0f172a;
      font-family: "Inter", sans-serif;
      color: #e2e8f0;
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }

    .wrapper {
      width: 360px;
      background: #1e293b;
      border-radius: 12px;
      border: 1px solid #334155;
      padding: 25px;
    }

    h2 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 10px;
      letter-spacing: 1px;
    }

    .captcha-box {
      text-align: center;
      background: #0f172a;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #475569;
      font-size: 20px;
      font-weight: bold;
      letter-spacing: 6px;
      margin-bottom: 10px;
    }

    #captchaCanvas {
      width: 100%;
      border-radius: 10px;
      border: 2px solid #334155;
    }

    #progress {
      text-align: center;
      color: #94a3b8;
      margin-top: 8px;
      font-size: 15px;
    }

    #success {
      display: none;
      margin-top: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #22c55e;
    }
  </style>
</head>

<body>

  <div class="wrapper">

    <h2>CAPTCHA Doğrulaması</h2>

    <div id="captchaText" class="captcha-box"></div>

    <canvas id="captchaCanvas" width="320" height="220"></canvas>

    <div id="progress">Lütfen yukarıdaki kodu sırayla tıklayın.</div>

    <div id="success">✔ Doğrulama Başarılı!</div>

  </div>

  <script>
    const canvas = document.getElementById("captchaCanvas");
    const ctx = canvas.getContext("2d");

    const progress = document.getElementById("progress");
    const success = document.getElementById("success");
    const captchaText = document.getElementById("captchaText");

    const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
    const code = Array.from({ length: 5 })
      .map(() => letters[Math.floor(Math.random() * letters.length)]);

    captchaText.innerHTML = code.join("");

    let currentIndex = 0;
    progress.innerHTML = "CAPTCHA kodunu sırayla tıklayın.";

    let falling = [];

    function spawnLetter(isTarget) {
      return {
        letter: isTarget ? code[currentIndex] : letters[Math.floor(Math.random() * letters.length)],
        x: Math.random() * 260 + 20,
        y: -20,
        speed: isTarget ? 2.2 : 1.4 + Math.random() * 2,
        drift: (Math.random() - 0.5) * 1.8,
        isTarget
      };
    }

    for (let i = 0; i < 8; i++) {
      falling.push(spawnLetter(i === 0));
    }

    function draw() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      falling.forEach((f, i) => {
        ctx.fillStyle = f.isTarget ? "#38bdf8" : "#64748b";
        ctx.font = "28px Arial";
        ctx.fillText(f.letter, f.x, f.y);

        f.y += f.speed;
        f.x += f.drift;

        if (f.x < 10 || f.x > 290) f.drift *= -1;

        if (f.y > 260) {
          falling[i] = spawnLetter(f.isTarget);
        }
      });

      requestAnimationFrame(draw);
    }

    draw();

    canvas.addEventListener("click", (e) => {
      if (currentIndex >= 5) return;

      const rect = canvas.getBoundingClientRect();
      const px = e.clientX - rect.left;
      const py = e.clientY - rect.top;

      for (let f of falling) {
        const hit = px > f.x - 10 && px < f.x + 20 && py > f.y - 25 && py < f.y + 10;

        if (hit) {
          if (f.isTarget) {
            burst(px, py);

            currentIndex++;
            captchaText.innerHTML =
              code
                .map((c, i) => i < currentIndex ? `<span style="color:#22c55e">${c}</span>` : c)
                .join("");

            if (currentIndex === 5) {
              success.style.display = "block";
              progress.innerHTML = "";
              return;
            }

            falling = [];
            for (let i = 0; i < 8; i++) {
              falling.push(spawnLetter(i === 0));
            }

            progress.innerHTML = "Doğru! Sıradaki harfi tıklayın.";
          } else {
            progress.innerHTML = `<span style="color:#ef4444">Yanlış harf! Tekrar deneyin.</span>`;
          }
        }
      }
    });

    function burst(x, y) {
      for (let i = 0; i < 20; i++) {
        ctx.fillStyle = "#22c55e";
        ctx.fillRect(
          x + (Math.random() - 0.5) * 20,
          y + (Math.random() - 0.5) * 20,
          3,
          3
        );
      }
    }
  </script>

</body>
</html>
