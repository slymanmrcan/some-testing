<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Advanced Trick CAPTCHA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: #0f172a;
      font-family: "Inter", sans-serif;
      color: #e2e8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    .box {
      width: 350px;
      background: #1e293b;
      border: 1px solid #334155;
      padding: 20px;
      border-radius: 12px;
    }

    #captchaCanvas {
      width: 100%;
      border-radius: 10px;
      border: 2px solid #334155;
      margin-top: 16px;
    }

    #status {
      margin-top: 16px;
      text-align: center;
      font-size: 15px;
      color: #94a3b8;
    }

    .success {
      color: #22c55e !important;
    }

    .fail {
      color: #ef4444 !important;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2 style="text-align:center; margin:0;">Karmaşık CAPTCHA</h2>
    <p style="font-size:14px; text-align:center;">Doğru harfi yakala ama dikkat et…</p>

    <canvas id="captchaCanvas" width="320" height="220"></canvas>
    <div id="status">Doğru harfi tıklayın.</div>
  </div>

  <script>
    const canvas = document.getElementById("captchaCanvas");
    const ctx = canvas.getContext("2d");
    const statusEl = document.getElementById("status");

    const letters = "ABCDEFGHJKLMNPQRSTUVWXYZ";
    const target = letters[Math.floor(Math.random() * letters.length)];

    let verified = false;

    // Çoklu düşen harfler (zorluk burada)
    const items = [];
    for (let i = 0; i < 8; i++) {
      items.push({
        letter: (i === 0 ? target : letters[Math.floor(Math.random() * letters.length)]),
        x: Math.random() * 260 + 20,
        y: Math.random() * -300,
        speed: 1.5 + Math.random() * 2.5,
        drift: (Math.random() - 0.5) * 2
      });
    }

    // Doğru harf gizli şekilde daha hızlı (kullanıcı anlamaz)
    items[0].speed *= 1.4;
    items[0].drift *= 1.5;

    function draw() {
      if (verified) return;

      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      items.forEach(it => {
        // harfi çiz
        ctx.fillStyle = "#38bdf8";
        ctx.font = "28px Arial";
        ctx.fillText(it.letter, it.x, it.y);

        // karmaşık hareket
        it.y += it.speed;
        it.x += it.drift;

        // kenarlardan sekme efekti
        if (it.x < 10 || it.x > 290) it.drift *= -1;

        // aşağı düştüyse resetle
        if (it.y > 260) {
          it.y = -30;
          it.x = Math.random() * 260 + 20;
        }
      });

      requestAnimationFrame(draw);
    }

    draw();

    // hit detection
    canvas.addEventListener("click", (e) => {
      if (verified) return;

      const rect = canvas.getBoundingClientRect();
      const px = e.clientX - rect.left;
      const py = e.clientY - rect.top;

      for (let it of items) {
        const hitX = px > it.x - 10 && px < it.x + 20;
        const hitY = py > it.y - 30 && px < it.x + 20;

        const hit = px > it.x - 5 && px < it.x + 20 && py > it.y - 25 && py < it.y + 5;

        if (hit) {
          if (it.letter === target) {
            verified = true;
            statusEl.textContent = `Doğru! Harf: ${target}`;
            statusEl.className = "success";

            // küçük bir patlama efekti
            explosion(px, py);
          } else {
            statusEl.textContent = "Yanlış harfe tıkladın!";
            statusEl.className = "fail";
          }
        }
      }
    });

    function explosion(x, y) {
      const size = 6;
      ctx.fillStyle = "#22c55e";
      for (let i = 0; i < 20; i++) {
        ctx.fillRect(x + Math.random() * size - size / 2, y + Math.random() * size - size / 2, 3, 3);
      }
    }

  </script>

</body>
</html>
